\chapter{Getting started with ggplot2}\label{cha:getting-started}

\section{Introduction}

The goal of this chapter is to teach you how to produce useful graphics
with ggplot2 as quickly as possible. You'll learn the basics of
\texttt{ggplot()} along with some useful ``recipes'' to make the most
important plots. \texttt{ggplot()} allows you to make complex plots with
just a few lines of code because it's based on a rich underlying theory,
the grammar of graphics. Here we'll skip the theory and focus on the
practice, and in later chapters you'll learn how to use the full
expressive power of the grammar.

In this chapter you'll learn:

\begin{itemize}
\item
  About the \texttt{mpg} dataset included with ggplot2,
  \hyperref[sec:fuel-economy-data]{mpg}.
\item
  The three key components of every plot: data, aesthetics and geoms,
  \hyperref[sec:basic-use]{key components}.
\item
  How to add additional variables to a plot with aesthetics,
  \hyperref[aesthetics]{aesthetics}.
\item
  How to display additional categorical variables in a plot using small
  multiples created by facetting,
  \hyperref[sec:qplot-facetting]{facetting}.
\item
  A variety of different geoms that you can use to create different
  types of plots, \hyperref[sec:plot-geoms]{geoms}.
\item
  How to modify the axes, \hyperref[sec:axes]{axes}.
\item
  Things you can do with a plot object other than display it, like save
  it to disk, \hyperref[sec:output]{output}.
\item
  \texttt{qplot()}, a handy shortcut for when you just want to quickly
  bang out a simple plot without thinking about the grammar at all,
  \hyperref[qplot]{qplot}.
\end{itemize}

\hyperdef{}{sec:fuel-economy-data}{\section{Fuel economy
data}\label{sec:fuel-economy-data}}

In this chapter, we'll mostly use one data set that's bundled with
ggplot2: \texttt{mpg}. It includes information about the fuel economy of
popular car models in 1999 and 2008, collected by the US Environmental
Protection Agency, \url{http://fueleconomy.gov}. You can access the data
by loading ggplot2: \index{Data!mpg@\texttt{mpg}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\NormalTok{mpg}
\CommentTok{#> Source: local data frame [234 x 11]}
\CommentTok{#> }
\CommentTok{#>    manufacturer model displ  year   cyl      trans   drv   cty   hwy}
\CommentTok{#>           (chr) (chr) (dbl) (int) (int)      (chr) (chr) (int) (int)}
\CommentTok{#> 1          audi    a4   1.8  1999     4   auto(l5)     f    18    29}
\CommentTok{#> 2          audi    a4   1.8  1999     4 manual(m5)     f    21    29}
\CommentTok{#> 3          audi    a4   2.0  2008     4 manual(m6)     f    20    31}
\CommentTok{#> 4          audi    a4   2.0  2008     4   auto(av)     f    21    30}
\CommentTok{#> 5          audi    a4   2.8  1999     6   auto(l5)     f    16    26}
\CommentTok{#> 6          audi    a4   2.8  1999     6 manual(m5)     f    18    26}
\CommentTok{#> ..          ...   ...   ...   ...   ...        ...   ...   ...   ...}
\CommentTok{#> Variables not shown: fl (chr), class (chr)}
\end{Highlighting}
\end{Shaded}

The variables are mostly self-explanatory:

\begin{itemize}
\item
  \texttt{cty} and \texttt{hwy} record miles per gallon (mpg) for city
  and highway driving.
\item
  \texttt{displ} is the engine displacement in litres.
\item
  \texttt{drv} is the drivetrain: front wheel (f), rear wheel (r) or
  four wheel (4).
\item
  \texttt{model} is the model of car. There are 38 models, selected
  because they had a new edition every year between 1999 and 2008.
\item
  \texttt{class} (not shown), is a categorical variable describing the
  ``type'' of car: two seater, SUV, compact, etc.
\end{itemize}

This dataset suggests many interesting questions. How are engine size
and fuel economy related? Do certain manufacturers care more about fuel
economy than others? Has fuel economy improved in the last ten years? We
will try to answer some of these questions, and in the process learn how
to create some basic plots with ggplot2.

\subsection{Exercises}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  List five functions that you could use to get more information about
  the \texttt{mpg} dataset.
\item
  How can you find out what other datasets are included with ggplot2?
\item
  Apart from the US, most countries use fuel consumption (fuel consumed
  over fixed distance) rather than fuel economy (distance travelled with
  fixed amount of fuel). How could you convert \texttt{cty} and
  \texttt{hwy} into the European standard of l/100km?
\item
  Which manufacturer has the most the models in this dataset? Which
  model has the most variations? Does your answer change if you remove
  the redundant specification of drive train (e.g. ``pathfinder 4wd'',
  ``a4 quattro'') from the model name?
\end{enumerate}

\hyperdef{}{sec:basic-use}{\section{Key
components}\label{sec:basic-use}}

Every ggplot2 plot has three key components:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \textbf{data},
\item
  A set of \textbf{aesthetic mappings} between variables in the data and
  visual properties, and
\item
  At least one layer which describes how to render each observation.
  Layers are usually created with a \textbf{geom} function.
\end{enumerate}

Here's a simple example: \index{Scatterplot} \indexf{ggplot}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \NormalTok{displ, }\DataTypeTok{y =} \NormalTok{hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.65\linewidth]{_figures/ggplot/qscatter-1}
\end{figure}

This produces a scatterplot defined by:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Data: \texttt{mpg}.
\item
  Aesthetic mapping: engine size mapped to x position, fuel economy to y
  position.
\item
  Layer: points.
\end{enumerate}

Pay attention to the structure of this function call: data and aesthetic
mappings are supplied in \texttt{ggplot()}, then layers are added on
with \texttt{+}. This is an important pattern, and as you learn more
about ggplot2 you'll construct increasingly sophisticated plots by
adding on more types of components.

Almost every plot maps a variable to \texttt{x} and \texttt{y}, so
naming these aesthetics is tedious, so the first two unnamed arguments
to \texttt{aes()} will be mapped to \texttt{x} and \texttt{y}. This
means that the following code is identical to the example above:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

I'll stick to that style throughout the book, so don't forget that the
first two arguments to \texttt{aes()} are \texttt{x} and \texttt{y}.
Note that I've put each command on a new line. I recommend doing this in
your own code, so it's easy to scan a plot specification and see exactly
what's there. In this chapter, I'll sometimes use just one line per
plot, because it makes it easier to see the differences between plot
variations.

The plot shows a strong correlation: as the engine size gets bigger, the
fuel economy gets worse. There are also some interesting outliers: some
cars with large engines get higher fuel economy than average. What sort
of cars do you think they are?

\subsection{Exercises}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  How would you describe the relationship between \texttt{cty} and
  \texttt{hwy}? Do you have any concerns about drawing conclusions from
  that plot?
\item
  What does
  \texttt{ggplot(mpg,\ aes(model,\ manufacturer))\ +\ geom\_point()}
  show? Is it useful? How could you modify the data to make it more
  informative?
\item
  Describe the data, aesthetic mappings and layers used for each of the
  following plots. You'll need to guess a little because you haven't
  seen all the datasets and functions yet, but use your common sense!
  See if you can predict what the plot will look like before running the
  code.

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \tightlist
  \item
    \texttt{ggplot(mpg,\ aes(cty,\ hwy))\ +\ geom\_point()}
  \item
    \texttt{ggplot(diamonds,\ aes(carat,\ price))\ +\ geom\_point()}
  \item
    \texttt{ggplot(economics,\ aes(date,\ unemploy))\ +\ geom\_line()}
  \item
    \texttt{ggplot(mpg,\ aes(cty))\ +\ geom\_histogram()}
  \end{enumerate}
\end{enumerate}

\hyperdef{}{aesthetics}{\section{Colour, size, shape and other aesthetic
attributes}\label{aesthetics}}

To add additional variables to a plot, we can use other aesthetics like
colour, shape, and size (NB: while I use British spelling throughout
this book, ggplot2 also accepts American spellings). These work in the
same way as the \texttt{x} and \texttt{y} aesthetics, and are added into
the call to \texttt{aes()}: \index{Aesthetics} \indexf{aes}

\begin{itemize}
\tightlist
\item
  \texttt{aes(displ,\ hwy,\ colour\ =\ class)}
\item
  \texttt{aes(displ,\ hwy,\ shape\ =\ drv)}
\item
  \texttt{aes(displ,\ hwy,\ size\ =\ cyl)}
\end{itemize}

ggplot2 takes care of the details of converting data (e.g., `f', `r',
`4') into aesthetics (e.g., `red', `yellow', `green') with a
\textbf{scale}. There is one scale for each aesthetic mapping in a plot.
The scale is also responsible for creating a guide, an axis or legend,
that allows you to read the plot, converting aesthetic values back into
data values. For now, we'll stick with the default scales provided by
ggplot2. You'll learn how to override them in \hyperref[cha:scales]{the
scales chapter}.

To learn more about those outlying variables in the previous
scatterplot, we could map the class variable to colour:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, cty, }\DataTypeTok{colour =} \NormalTok{class)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.65\linewidth]{_figures/ggplot/qplot-aesthetics-1}
\end{figure}

This gives each point a unique colour corresponding to its class. The
legend allows us to read data values from the colour, showing us that
the group of cars with unusually high fuel economy for their engine size
are two seaters: cars with big engines, but lightweight bodies.

If you want to set an aesthetic to a fixed value, without scaling it, do
so in the individual layer outside of \texttt{aes()}. Compare the
following two plots: \index{Aesthetics!setting}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"blue"}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-4-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-4-2}
\end{figure}

In the first plot, the value ``blue'' is scaled to a pinkish colour, and
a legend is added. In the second plot, the points are given the R colour
blue. This is an important technique and you'll learn more about it in
\hyperref[sub:setting-mapping]{setting vs.~mapping}. See
\texttt{vignette("ggplot2-specs")} for the values needed for colour and
other aesthetics.

Different types of aesthetic attributes work better with different types
of variables. For example, colour and shape work well with categorical
variables, while size works well for continuous variables. The amount of
data also makes a difference: if there is a lot of data it can be hard
to distinguish different groups. An alternative solution is to use
facetting, as described next.

When using aesthetics in a plot, less is usually more. It's difficult to
see the simultaneous relationships among colour and shape and size, so
exercise restraint when using aesthetics. Instead of trying to make one
very complex plot that shows everything at once, see if you can create a
series of simple plots that tell a story, leading the reader from
ignorance to knowledge.

\subsection{Exercises}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Experiment with the colour, shape and size aesthetics. What happens
  when you map them to continuous values? What about categorical values?
  What happens when you use more than one aesthetic in a plot?
\item
  What happens if you map a continuous variable to shape? Why? What
  happens if you map \texttt{trans} to shape? Why?
\item
  How is drive train related to fuel economy? How is drive train related
  to engine size and class?
\end{enumerate}

\hyperdef{}{sec:qplot-facetting}{\section{Facetting}\label{sec:qplot-facetting}}

Another technique for displaying additional categorical variables on a
plot is facetting. Facetting creates tables of graphics by splitting the
data into subsets and displaying the same graph for each subset. You'll
learn more about facetting in \hyperref[sec:facetting]{Facetting}, but
it's such a useful technique that you need to know it right away.
\index{Facetting}

There are two types of facetting: grid and wrapped. Wrapped is the most
useful, so we'll discuss it here, and you can learn about grid facetting
later. To facet a plot you simply add a facetting specification with
\texttt{facet\_wrap()}, which takes the name of a variable preceded by
\texttt{\textasciitilde{}}. \indexf{facet\_wrap}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() +}\StringTok{ }
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(~class)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=1\linewidth]{_figures/ggplot/facet-1}
\end{figure}

You might wonder when to use facetting and when to use aesthetics.
You'll learn more about the relative advantages and disadvantages of
each in \hyperref[sub:group-vs-facet]{grouping vs.~facetting}.

\subsection{Exercises}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What happens if you try to facet by a continuous variable like
  \texttt{hwy}? What about \texttt{cyl}? What's the key difference?
\item
  Use facetting to explore the 3-way relationship between fuel economy,
  engine size, and number of cylinders. How does facetting by number of
  cylinders change your assessement of the relationship between engine
  size and fuel economy?
\item
  Read the documentation for \texttt{facet\_wrap()}. What arguments can
  you use to control how many rows and columns appear in the output?
\item
  What does the \texttt{scales} argument to \texttt{facet\_wrap()} do?
  When might you use it?
\end{enumerate}

\hyperdef{}{sec:plot-geoms}{\section{Plot geoms}\label{sec:plot-geoms}}

You might guess that by substituting \texttt{geom\_point()} for a
different geom function, you'd get a different type of plot. That's a
great guess! In the following sections, you'll learn about some of the
other important geoms provided in ggplot2. This isn't an exhaustive
list, but should cover the most commonly used plot types. You'll learn
more in \hyperref[cha:toolbox]{the toolbox}.

\begin{itemize}
\item
  \texttt{geom\_smooth()} fits a smoother to the data and displays the
  smooth and its standard error.
\item
  \texttt{geom\_boxplot()} produces a box-and-whisker plot to summarise
  the distribution of a set of points.
\item
  \texttt{geom\_histogram()} and \texttt{geom\_freqpoly()} show the
  distribution of continuous variables.
\item
  \texttt{geom\_bar()} shows the distribution of categorical variables.
\item
  \texttt{geom\_path()} and \texttt{geom\_line()} draw lines between the
  data points. A line plot is constrained to produce lines that travel
  from left to right, while paths can go in any direction. Lines are
  typically used to explore how things change over time.
\end{itemize}

\subsection{Adding a smoother to a plot}\label{sub:smooth}

If you have a scatterplot with a lot of noise, it can be hard to see the
dominant pattern. In this case it's useful to add a smoothed line to the
plot with \texttt{geom\_smooth()}: \index{Smoothing}
\indexf{geom\_smooth}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.65\linewidth]{_figures/ggplot/qplot-smooth-1}
\end{figure}

This overlays the scatterplot with a smooth curve, including an
assessment of uncertainty in the form of point-wise confidence intervals
shown in grey. If you're not interested in the confidence interval, turn
it off with \texttt{geom\_smooth(se\ =\ FALSE)}.

An important argument to \texttt{geom\_smooth()} is the \texttt{method},
which allows you to choose which type of model is used to fit the smooth
curve:

\begin{itemize}
\item
  \texttt{method\ =\ "loess"}, the default for small n, uses a smooth
  local regression (as described in \texttt{?loess}). The wiggliness of
  the line is controlled by the \texttt{span} parameter, which ranges
  from 0 (exceedingly wiggly) to 1 (not so wiggly).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{span =} \FloatTok{0.2}\NormalTok{)}

\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{span =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

  \begin{figure}[H]
    \includegraphics[width=0.5\linewidth]{_figures/ggplot/smooth-loess-1}%
    \includegraphics[width=0.5\linewidth]{_figures/ggplot/smooth-loess-2}
  \end{figure}

  Loess does not work well for large datasets (it's \(O(n^2)\) in
  memory), so an alternative smoothing algorithm is used when \(n\) is
  greater than 1,000.
\item
  \texttt{method\ =\ "gam"} fits a generalised additive model provided
  by the \textbf{mgcv} package. You need to first load mgcv, then use a
  formula like \texttt{formula\ =\ y\ \textasciitilde{}\ s(x)} or
  \texttt{y\ \textasciitilde{}\ s(x,\ bs\ =\ "cs")} (for large data).
  This is what ggplot2 uses when there are more than 1,000 points.
  \index{mgcv}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(mgcv)}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"gam"}\NormalTok{, }\DataTypeTok{formula =} \NormalTok{y ~}\StringTok{ }\KeywordTok{s}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

  \begin{figure}[H]
    \includegraphics[width=0.5\linewidth]{_figures/ggplot/smooth-gam-1}
  \end{figure}
\item
  \texttt{method\ =\ "lm"} fits a linear model, giving the line of best
  fit.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

  \begin{figure}[H]
    \includegraphics[width=0.5\linewidth]{_figures/ggplot/smooth-lm-1}
  \end{figure}
\item
  \texttt{method\ =\ "rlm"} works like \texttt{lm()}, but uses a robust
  fitting algorithm so that outliers don't affect the fit as much. It's
  part of the \textbf{MASS} package, so remember to load that first.
  \index{MASS}
\end{itemize}

\subsection{Boxplots and jittered points}\label{sub:boxplot}

When a set of data includes a categorical variable and one or more
continuous variables, you will probably be interested to know how the
values of the continuous variables vary with the levels of the
categorical variable. Say we're interested in seeing how fuel economy
varies within car class. We might start with a scatterplot like this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-5-1}
\end{figure}

Because there are few unique values of both class and hwy, there is a
lot of overplotting. Many points are plotted in the same location, and
it's difficult to see the distribution. There are three useful
techniques that help alleviate the problem:

\begin{itemize}
\item
  Jittering, \texttt{geom\_jitter()}, adds a little random noise to the
  data which can help avoid overplotting. \index{Jittering}
  \indexf{geom\_jitter}
\item
  Boxplots, \texttt{geom\_boxplot()}, summarise the shape of the
  distribution with a handful of summary statistics. \index{Boxplot}
  \indexf{geom\_boxplot}
\item
  Violin plots, \texttt{geom\_violin()}, show a compact representation
  of the ``density'' of the distribution, highlighting the areas where
  more points are found. \index{Violin plot} \indexf{geom\_violin}
\end{itemize}

These are illustrated below:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}\StringTok{ }\KeywordTok{geom_jitter}\NormalTok{()}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{()}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}\StringTok{ }\KeywordTok{geom_violin}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/jitter-boxplot-1}%
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/jitter-boxplot-2}%
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/jitter-boxplot-3}
\end{figure}

Each method has its strengths and weaknesses. Boxplots summarise the
bulk of the distribution with only five numbers, while jittered plots
show every point but only work with relatively small datasets. Violin
plots give the richest display, but rely on the calculation of a density
estimate, which can be hard to interpret.

For jittered points, \texttt{geom\_jitter()} offers the same control
over aesthetics as \texttt{geom\_point()}: \texttt{size},
\texttt{colour}, and \texttt{shape}. For \texttt{geom\_boxplot()} and
\texttt{geom\_violin()}, you can control the outline \texttt{colour} or
the internal \texttt{fill} colour.

\subsection{Histograms and frequency polygons}\label{sub:distribution}

Histograms and frequency polygons show the distribution of a single
numeric variable. They provide more information about the distribution
of a single group than boxplots do, at the expense of needing more
space. \index{Histogram} \indexf{geom\_histogram}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(hwy)) +}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{()}
\CommentTok{#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(hwy)) +}\StringTok{ }\KeywordTok{geom_freqpoly}\NormalTok{()}
\CommentTok{#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/dist-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/dist-2}
\end{figure}

Both histograms and frequency polygons work in the same way: they bin
the data, then count the number of observations in each bin. The only
difference is the display: histograms use bars and frequency polygons
use lines.

You can control the width of the bins with the \texttt{binwidth}
argument (if you don't want evenly spaced bins you can use the
\texttt{breaks} argument). It is \textbf{very important} to experiment
with the bin width. The default just splits your data into 30 bins,
which is unlikely to be the best choice. You should always try many bin
widths, and you may find you need multiple bin widths to tell the full
story of your data.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_freqpoly}\NormalTok{(}\DataTypeTok{binwidth =} \FloatTok{2.5}\NormalTok{)}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(hwy)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_freqpoly}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-6-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-6-2}
\end{figure}

An alternative to the frequency polygon is the density plot,
\texttt{geom\_density()}. I'm not a fan of density plots because they
are harder to interpret since the underlying computations are more
complex. They also make assumptions that are not true for all data,
namely that the underlying distribution is continuous, unbounded, and
smooth.

To compare the distributions of different subgroups, you can map a
categorical variable to either fill (for \texttt{geom\_histogram()}) or
colour (for \texttt{geom\_freqpoly()}). It's easier to compare
distributions using the frequency polygon because the underlying
perceptual task is easier. You can also use facetting: this makes
comparisons a little harder, but it's easier to see the distribution of
each group.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, }\DataTypeTok{colour =} \NormalTok{drv)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_freqpoly}\NormalTok{(}\DataTypeTok{binwidth =} \FloatTok{0.5}\NormalTok{)}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, }\DataTypeTok{fill =} \NormalTok{drv)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \FloatTok{0.5}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(~drv, }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/dist-fill-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/dist-fill-2}
\end{figure}

\subsection{Bar charts}\label{sub:bar}

The discrete analogue of the histogram is the bar chart,
\texttt{geom\_bar()}. It's easy to use: \index{Barchart}
\indexf{geom\_bar}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(manufacturer)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=1\linewidth]{_figures/ggplot/dist-bar-1}
\end{figure}

(You'll learn how to fix the labels in \hyperref[sub:theme-axis]{axis
labels}).

Bar charts can be confusing because there are two rather different plots
that are both commonly called bar charts. The above form expects you to
have unsummarised data, and each observation contributes one unit to the
height of each bar. The other form of bar chart is used for
presummarised data. For example, you might have three drugs with their
average effect:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{drugs <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
  \DataTypeTok{drug =} \KeywordTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{),}
  \DataTypeTok{effect =} \KeywordTok{c}\NormalTok{(}\FloatTok{4.2}\NormalTok{, }\FloatTok{9.7}\NormalTok{, }\FloatTok{6.1}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

To display this sort of data, you need to tell \texttt{geom\_bar()} to
not run the default stat which bins and counts the data. However, I
think it's even better to use \texttt{geom\_point()} because points take
up less space than bars, and don't require that the y axis includes 0.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(drugs, }\KeywordTok{aes}\NormalTok{(drug, effect)) +}\StringTok{ }\KeywordTok{geom_bar}\NormalTok{(}\DataTypeTok{stat =} \StringTok{"identity"}\NormalTok{)}
\KeywordTok{ggplot}\NormalTok{(drugs, }\KeywordTok{aes}\NormalTok{(drug, effect)) +}\StringTok{ }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-8-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-8-2}
\end{figure}

\subsection{Time series with line and path plots}\label{sub:line}

Line and path plots are typically used for time series data. Line plots
join the points from left to right, while path plots join them in the
order that they appear in the dataset (in other words, a line plot is a
path plot of the data sorted by x value). Line plots usually have time
on the x-axis, showing how a single variable has changed over time. Path
plots show how two variables have simultaneously changed over time, with
time encoded in the way that observations are connected.

Because the year variable in the \texttt{mpg} dataset only has two
values, we'll show some time series plots using the \texttt{economics}
dataset, which contains economic data on the US measured over the last
40 years. The figure below shows two plots of unemployment over time,
both produced using \texttt{geom\_line()}. The first shows the
unemployment rate while the second shows the median number of weeks
unemployed. We can already see some differences in these two variables,
particularly in the last peak, where the unemployment percentage is
lower than it was in the preceding peaks, but the length of unemployment
is high. \indexf{geom\_line} \indexf{geom\_path}
\index{Data!economics@\texttt{economics}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(economics, }\KeywordTok{aes}\NormalTok{(date, unemploy /}\StringTok{ }\NormalTok{pop)) +}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{()}
\KeywordTok{ggplot}\NormalTok{(economics, }\KeywordTok{aes}\NormalTok{(date, uempmed)) +}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/line-employment-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/line-employment-2}
\end{figure}

To examine this relationship in greater detail, we would like to draw
both time series on the same plot. We could draw a scatterplot of
unemployment rate vs.~length of unemployment, but then we could no
longer see the evolution over time. The solution is to join points
adjacent in time with line segments, forming a \emph{path} plot.

Below we plot unemployment rate vs.~length of unemployment and join the
individual observations with a path. Because of the many line crossings,
the direction in which time flows isn't easy to see in the first plot.
In the second plot, we colour the points to make it easier to see the
direction of time.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(economics, }\KeywordTok{aes}\NormalTok{(unemploy /}\StringTok{ }\NormalTok{pop, uempmed)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_path}\NormalTok{() +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}

\NormalTok{year <-}\StringTok{ }\NormalTok{function(x) }\KeywordTok{as.POSIXlt}\NormalTok{(x)$year +}\StringTok{ }\DecValTok{1900}
\KeywordTok{ggplot}\NormalTok{(economics, }\KeywordTok{aes}\NormalTok{(unemploy /}\StringTok{ }\NormalTok{pop, uempmed)) +}\StringTok{ }
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}\DataTypeTok{colour =} \StringTok{"grey50"}\NormalTok{) +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{colour =} \KeywordTok{year}\NormalTok{(date)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/path-employ-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/path-employ-2}
\end{figure}

We can see that unemployment rate and length of unemployment are highly
correlated, but in recent years the length of unemployment has been
increasing relative to the unemployment rate.

With longitudinal data, you often want to display multiple time series
on each plot, each series representing one individual. To do this you
need to map the \texttt{group} aesthetic to a variable encoding the
group membership of each observation. This is explained in more depth in
\hyperref[sec:grouping]{grouping}.
\index{Longitudinal data|see{Data, longitudinal}}
\index{Data!longitudinal}

\subsection{Exercises}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  What's the problem with the plot created by
  \texttt{ggplot(mpg,\ aes(cty,\ hwy))\ +\ geom\_point()}? Which of the
  geoms described above is most effective at remedying the problem?
\item
  One challenge with
  \texttt{ggplot(mpg,\ aes(class,\ hwy))\ +\ geom\_boxplot()} is that
  the ordering of \texttt{class} is alphabetical, which is not terribly
  useful. How could you change the factor levels to be more informative?

  Rather than reordering the factor by hand, you can do it automatically
  based on the data:
  \texttt{ggplot(mpg,\ aes(reorder(class,\ hwy),\ hwy))\ +\ geom\_boxplot()}.
  What does \texttt{reorder()} do? Read the documentation.
\item
  Explore the distribution of the carat variable in the
  \texttt{diamonds} dataset. What binwidth reveals the most interesting
  patterns?
\item
  Explore the distribution of the price variable in the
  \texttt{diamonds} data. How does the distribution vary by cut?
\item
  You now know (at least) three ways to compare the distributions of
  subgroups: \texttt{geom\_violin()}, \texttt{geom\_freqpoly()} and the
  colour aesthetic, or \texttt{geom\_histogram()} and facetting. What
  are the strengths and weaknesses of each approach? What other
  approaches could you try?
\item
  Read the documentation for \texttt{geom\_bar()}. What does the
  \texttt{weight} aesthetic do?
\item
  Using the techniques already discussed in this chapter, come up with
  three ways to visualise a 2d categorical distribution. Try them out by
  visualising the distribution of \texttt{model} and
  \texttt{manufacturer}, \texttt{trans} and \texttt{class}, and
  \texttt{cyl} and \texttt{trans}.
\end{enumerate}

\hyperdef{}{sec:axes}{\section{Modifying the axes}\label{sec:axes}}

You'll learn the full range of options available in
\hyperref[cha:scales]{scales}, but two families of useful helpers let
you make the most common modifications. \texttt{xlab()} and
\texttt{ylab()} modify the x- and y-axis labels: \indexf{xlab}
\indexf{ylab}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(cty, hwy)) +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{1} \NormalTok{/}\StringTok{ }\DecValTok{3}\NormalTok{)}

\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(cty, hwy)) +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{1} \NormalTok{/}\StringTok{ }\DecValTok{3}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\StringTok{"city driving (mpg)"}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"highway driving (mpg)"}\NormalTok{)}

\CommentTok{# Remove the axis labels with NULL}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(cty, hwy)) +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{1} \NormalTok{/}\StringTok{ }\DecValTok{3}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{xlab}\NormalTok{(}\OtherTok{NULL}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\OtherTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/unnamed-chunk-9-1}%
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/unnamed-chunk-9-2}%
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/unnamed-chunk-9-3}
\end{figure}

\texttt{xlim()} and \texttt{ylim()} modify the limits of axes:
\indexf{xlim} \indexf{ylim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}
\StringTok{  }\KeywordTok{geom_jitter}\NormalTok{(}\DataTypeTok{width =} \FloatTok{0.25}\NormalTok{)}

\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}
\StringTok{  }\KeywordTok{geom_jitter}\NormalTok{(}\DataTypeTok{width =} \FloatTok{0.25}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{xlim}\NormalTok{(}\StringTok{"f"}\NormalTok{, }\StringTok{"r"}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{ylim}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{)}
\CommentTok{#> Warning: Removed 138 rows containing missing values (geom_point).}
  
\CommentTok{# For continuous scales, use NA to set only one limit}
\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(drv, hwy)) +}
\StringTok{  }\KeywordTok{geom_jitter}\NormalTok{(}\DataTypeTok{width =} \FloatTok{0.25}\NormalTok{, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{) +}\StringTok{ }
\StringTok{  }\KeywordTok{ylim}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/unnamed-chunk-10-1}%
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/unnamed-chunk-10-2}%
  \includegraphics[width=0.333\linewidth]{_figures/ggplot/unnamed-chunk-10-3}
\end{figure}

Changing the axes limits sets values outside the range to \texttt{NA}.
You can suppress the associated warning with \texttt{na.rm\ =\ TRUE}.

\hyperdef{}{sec:output}{\section{Output}\label{sec:output}}

Most of the time you create a plot object and immediately plot it, but
you can also save a plot to a variable and manipulate it:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(mpg, }\KeywordTok{aes}\NormalTok{(displ, hwy, }\DataTypeTok{colour =} \KeywordTok{factor}\NormalTok{(cyl))) +}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Once you have a plot object, there are a few things you can do with it:

\begin{itemize}
\item
  Render it on screen with \texttt{print()}. This happens automatically
  when running interactively, but inside a loop or function, you'll need
  to \texttt{print()} it yourself. \indexf{print}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.65\linewidth]{_figures/ggplot/unnamed-chunk-11-1}
  \end{figure}
\item
  Save it to disk with \texttt{ggsave()}, described in
  \hyperref[sec:saving]{saving your output}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Save png to disk}
\KeywordTok{ggsave}\NormalTok{(}\StringTok{"plot.png"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{5}\NormalTok{, }\DataTypeTok{height =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\item
  Briefly describe its structure with \texttt{summary()}.
  \indexf{summary}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(p)}
\CommentTok{#> data: manufacturer, model, displ, year, cyl, trans, drv, cty,}
\CommentTok{#>   hwy, fl, class [234x11]}
\CommentTok{#> mapping:  x = displ, y = hwy, colour = factor(cyl)}
\CommentTok{#> faceting: facet_null() }
\CommentTok{#> -----------------------------------}
\CommentTok{#> geom_point: na.rm = FALSE}
\CommentTok{#> stat_identity: na.rm = FALSE}
\CommentTok{#> position_identity}
\end{Highlighting}
\end{Shaded}
\item
  Save a cached copy of it to disk, with \texttt{saveRDS()}. This saves
  a complete copy of the plot object, so you can easily re-create it
  with \texttt{readRDS()}. \indexf{saveRDS} \indexf{readRDS}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{saveRDS}\NormalTok{(p, }\StringTok{"plot.rds"}\NormalTok{)}
\NormalTok{q <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"plot.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{itemize}

You'll learn more about how to manipulate these objects in
\hyperref[cha:programming]{programming with ggplot2}.

\hyperdef{}{qplot}{\section{Quick plots}\label{qplot}}

In some cases, you will want to create a quick plot with a minimum of
typing. In these cases you may prefer to use \texttt{qplot()} over
\texttt{ggplot()}. \texttt{qplot()} lets you define a plot in a single
call, picking a geom by default if you don't supply one. To use it,
provide a set of aesthetics and a data set: \indexf{qplot}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{qplot}\NormalTok{(displ, hwy, }\DataTypeTok{data =} \NormalTok{mpg)}
\KeywordTok{qplot}\NormalTok{(displ, }\DataTypeTok{data =} \NormalTok{mpg)}
\CommentTok{#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-15-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-15-2}
\end{figure}

Unless otherwise specified, \texttt{qplot()} tries to pick a sensible
geometry and statistic based on the arguments provided. For example, if
you give \texttt{qplot()} \texttt{x} and \texttt{y} variables, it'll
create a scatterplot. If you just give it an \texttt{x}, it'll create a
histogram or bar chart depending on the type of variable.

\texttt{qplot()} assumes that all variables should be scaled by default.
If you want to set an aesthetic to a constant, you need to use
\texttt{I()}: \indexf{I}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{qplot}\NormalTok{(displ, hwy, }\DataTypeTok{data =} \NormalTok{mpg, }\DataTypeTok{colour =} \StringTok{"blue"}\NormalTok{)}
\KeywordTok{qplot}\NormalTok{(displ, hwy, }\DataTypeTok{data =} \NormalTok{mpg, }\DataTypeTok{colour =} \KeywordTok{I}\NormalTok{(}\StringTok{"blue"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-16-1}%
  \includegraphics[width=0.5\linewidth]{_figures/ggplot/unnamed-chunk-16-2}
\end{figure}

If you're used to \texttt{plot()} you may find \texttt{qplot()} to be a
useful crutch to get up and running quickly. However, while it's
possible to use \texttt{qplot()} to access all of the customizability of
ggplot2, I don't recommend it. If you find yourself making a more
complex graph, e.g.~using different aesthetics in different layers or
manually setting visual properties, use \texttt{ggplot()}, not
\texttt{qplot()}.
